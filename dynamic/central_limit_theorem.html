<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Limit Theorem Explorer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f1f5f9; }
        /* Custom Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #4f46e5; /* Indigo-600 */
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-6xl overflow-hidden flex flex-col lg:flex-row">
        
        <!-- Controls Panel -->
        <div class="w-full lg:w-1/3 p-8 bg-slate-50 border-r border-slate-100 flex flex-col justify-between">
            <div>
                <h1 class="text-2xl font-bold text-slate-800 mb-2">Central Limit Theorem</h1>
                <p class="text-sm text-slate-500 mb-6">From Chaos to Order.<br>Converging to the Normal Distribution.</p>

                <!-- 1. Distribution Picker -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-slate-700 mb-3">1. Parent Distribution</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setDist('uniform')" id="btn-uniform" class="px-3 py-2 rounded-lg text-sm font-bold border-2 transition-colors border-indigo-500 bg-indigo-50 text-indigo-700">
                            Uniform
                        </button>
                        <button onclick="setDist('exponential')" id="btn-exponential" class="px-3 py-2 rounded-lg text-sm font-bold border-2 border-slate-200 text-slate-600 hover:border-slate-300">
                            Exponential
                        </button>
                        <button onclick="setDist('bimodal')" id="btn-bimodal" class="px-3 py-2 rounded-lg text-sm font-bold border-2 border-slate-200 text-slate-600 hover:border-slate-300">
                            Bimodal
                        </button>
                    </div>
                    <p id="dist-desc" class="text-xs text-slate-400 mt-2 italic">Flat random noise.</p>
                </div>

                <!-- 2. Sample Size Slider (n) -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <label class="font-bold text-slate-700 text-sm">2. Sample Size (n)</label>
                        <span id="val-n" class="font-mono text-indigo-600 font-bold text-xl">1</span>
                    </div>
                    <input type="range" id="slider-n" min="1" max="50" step="1" value="1">
                    <p class="text-[10px] text-slate-400 mt-1">
                        How many numbers to average in one experiment.
                    </p>
                </div>

                <!-- 3. Repetitions Slider (k) -->
                <div class="mb-6">
                    <div class="flex justify-between mb-2">
                        <label class="font-bold text-slate-700 text-sm">3. Repetitions</label>
                        <span id="val-k" class="font-mono text-indigo-600 font-bold text-xl">500</span>
                    </div>
                    <input type="range" id="slider-k" min="100" max="10000" step="100" value="500">
                    <p class="text-[10px] text-slate-400 mt-1">
                        How many experiments to run (builds the histogram).
                    </p>
                </div>

                <button onclick="runSimulation()" class="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition shadow-lg flex items-center justify-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                    </svg>
                    <span>Run Simulation</span>
                </button>
            </div>

            <!-- Concept Insight -->
            <div class="mt-6 pt-4 border-t border-slate-200">
                <p class="text-xs font-bold text-slate-400 uppercase mb-2">Math Insight</p>
                <div class="text-xs text-slate-600 space-y-2">
                    <p>As \(n\) increases, the standard deviation of the means shrinks:</p>
                    <div class="text-center bg-slate-100 p-2 rounded">
                        \[ \sigma_{\bar{x}} = \frac{\sigma}{\sqrt{n}} \]
                    </div>
                    <p>This is why the curve gets narrower!</p>
                </div>
            </div>
        </div>

        <!-- Charts Panel -->
        <div class="w-full lg:w-2/3 p-6 bg-white flex flex-col space-y-4">
            
            <!-- Top Chart: Parent Distribution -->
            <div class="h-40 w-full relative">
                <p class="absolute top-2 left-2 text-xs font-bold text-slate-400 uppercase">Parent Distribution (The Source)</p>
                <canvas id="parentChart"></canvas>
            </div>

            <div class="border-t border-slate-100"></div>

            <!-- Bottom Chart: Distribution of Means -->
            <div class="flex-1 w-full relative min-h-[300px]">
                <p class="absolute top-2 left-2 text-xs font-bold text-indigo-500 uppercase">Distribution of Sample Means</p>
                <canvas id="meansChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const sN = document.getElementById('slider-n');
        const sK = document.getElementById('slider-k');
        const vN = document.getElementById('val-n');
        const vK = document.getElementById('val-k');
        const distDesc = document.getElementById('dist-desc');
        
        let currentDist = 'uniform';
        let parentChart, meansChart;

        // --- Math Generators ---
        
        // 1. Uniform: Random between 0 and 100
        function genUniform() {
            return Math.random() * 100;
        }

        // 2. Exponential: Skewed data (like wait times)
        // Mean approx 20. Skews heavily right.
        function genExponential() {
            return -Math.log(1 - Math.random()) * 20; 
        }

        // 3. Bimodal: Two humps (e.g., test scores of two different groups)
        // Mix of N(30, 10) and N(70, 10)
        // Box-Muller transform for Normal dist
        function randn_bm() {
            let u = 0, v = 0;
            while(u === 0) u = Math.random(); 
            while(v === 0) v = Math.random();
            return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
        }

        function genBimodal() {
            if (Math.random() < 0.5) {
                return 30 + randn_bm() * 10;
            } else {
                return 70 + randn_bm() * 10;
            }
        }

        // --- Logic ---

        function getGenerator() {
            if (currentDist === 'uniform') return genUniform;
            if (currentDist === 'exponential') return genExponential;
            if (currentDist === 'bimodal') return genBimodal;
            return genUniform;
        }

        function getIdealParentData() {
            // Generate data for the top chart to show the "Ideal" shape
            const bins = 50;
            const data = new Array(bins).fill(0);
            const samples = 10000;
            const gen = getGenerator();
            
            for(let i=0; i<samples; i++) {
                let val = gen();
                // Clamp to 0-100 for display
                let idx = Math.floor(val / (100/bins));
                if(idx >= 0 && idx < bins) data[idx]++;
            }
            return data;
        }

        function setDist(type) {
            currentDist = type;
            
            // Update Buttons Styles
            ['uniform', 'exponential', 'bimodal'].forEach(t => {
                const btn = document.getElementById('btn-'+t);
                if (t === type) {
                    btn.className = "px-3 py-2 rounded-lg text-sm font-bold border-2 transition-colors border-indigo-500 bg-indigo-50 text-indigo-700";
                } else {
                    btn.className = "px-3 py-2 rounded-lg text-sm font-bold border-2 border-slate-200 text-slate-600 hover:border-slate-300";
                }
            });

            // Update Description
            if (type === 'uniform') distDesc.textContent = "Flat random noise (0 to 100).";
            if (type === 'exponential') distDesc.textContent = "Highly skewed. Like wait times or income.";
            if (type === 'bimodal') distDesc.textContent = "Two peaks. Like two distinct populations mixed.";

            // Update Parent Chart immediately
            updateParentChart();
            runSimulation();
        }

        function runSimulation() {
            const n = parseInt(sN.value);
            const k = parseInt(sK.value);
            
            vN.textContent = n;
            vK.textContent = k;

            const gen = getGenerator();
            const means = [];

            // The Simulation Loop
            for (let i = 0; i < k; i++) {
                let sum = 0;
                for (let j = 0; j < n; j++) {
                    sum += gen();
                }
                means.push(sum / n);
            }

            updateMeansChart(means);
        }

        // --- Charting ---

        function updateParentChart() {
            const data = getIdealParentData();
            const labels = data.map((_, i) => (i * 2).toString()); // 0-100 range

            if (parentChart) parentChart.destroy();

            const ctx = document.getElementById('parentChart').getContext('2d');
            parentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: data,
                        backgroundColor: '#cbd5e1', // Slate-300
                        borderRadius: 2,
                        barPercentage: 1.0,
                        categoryPercentage: 1.0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: {
                        x: { display: false, min: 0, max: 100 },
                        y: { display: false }
                    }
                }
            });
        }

        function updateMeansChart(means) {
            // Bin the means
            const bins = 50;
            const rangeMax = 100;
            const counts = new Array(bins).fill(0);
            
            means.forEach(m => {
                let idx = Math.floor(m / (rangeMax/bins));
                if(idx >= 0 && idx < bins) counts[idx]++;
            });

            const labels = counts.map((_, i) => Math.floor(i * (rangeMax/bins)));

            if (meansChart) meansChart.destroy();

            const ctx = document.getElementById('meansChart').getContext('2d');
            meansChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Distribution of Means',
                        data: counts,
                        backgroundColor: '#6366f1', // Indigo-500
                        borderRadius: 4,
                        barPercentage: 1.0,
                        categoryPercentage: 1.0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 500 },
                    plugins: { 
                        legend: { display: false },
                        annotation: {
                            // We could add a theoretical curve overlay here later
                        }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 'Mean Value' },
                            ticks: { maxTicksLimit: 10 }
                        },
                        y: { display: false }
                    }
                }
            });
        }

        // Listeners
        sN.addEventListener('input', () => { vN.textContent = sN.value; });
        sN.addEventListener('change', runSimulation); // Update on release to save perf
        
        sK.addEventListener('input', () => { vK.textContent = sK.value; });
        sK.addEventListener('change', runSimulation);

        // Init
        updateParentChart();
        runSimulation();

    </script>
</body>
</html>